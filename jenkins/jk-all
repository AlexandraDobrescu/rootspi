#!/usr/bin/env bash

THIS=$(dirname $0)

echo source $THIS/jk-setup.sh $LABEL $COMPILER $BUILDTYPE $EXTERNALS
source $THIS/jk-setup.sh $LABEL $COMPILER $BUILDTYPE $EXTERNALS

echo "Dumping the full environment ---------------------------------------------------------"
env | sort | sed 's/:/:?     /g' | tr '?' '\n'
echo "--------------------------------------------------------------------------------------"

#---Create stampfile to enable our jenkins to purge old builds------------------------------
touch $WORKSPACE/controlfile

#---Run the CTest script depending on the compiler------------------------------------------
if [[ $COMPILER == *classic* ]]
then
    ctest -VV -S ${THIS}/root-classic.cmake
    build_rc=$?
    #ctest -V -S ${THIS}/root-test-classic.cmake
else
    ctest -VV -S ${THIS}/root-build.cmake
    build_rc=$?
    ctest -V -S ${THIS}/root-test.cmake
fi

exit $build_rc


